\chapter{Špecifikácia problému a návrh riešenia}

%\section{Problematika}

%\paragraph{}



%\section{Možné riešenia}

%\subsection{Identické inštalácie}
%\paragraph{}
%Jedno z riešení by bolo, nainštalovať jeden počítač, spraviť jeho dokonalú kópiu a túto distribuovať na ostatné počítače. Toto riešenie funguje vynikajúco do momentu kedy množina počitačov obsahuje počítače s inou hardwarovou konfiguráciou, vtedy táto metóda nie je funkčná, keďže dokonalou kópiou sa presúvajú aj drivery a údaje, ktoré su špecifické pre daný hardware. Ďalšou možnosťou by bolo vyrobiť program, ktorému by sme ako vstup dali inštalácie programov, ktoré chceme nainštalovať a on by automaticky týmito inštaláciami prešiel. Tu avšak narážame na problém, že mnoho vývojarov softwaru si vytvára vlastné inštalačné programy, ktoré sa môžu správať neštandartne.

%\paragraph{}
%Posledné riešenie má problém s neštandartnými inštalačnými programami, čo ak by sme štandardizovali všetky inštalácie ? Inštalácie nech vyzerajú akokoľvek zložito a pekne, sú zložené len z kopírovania súborov a zápisu určitej informácie do registrov. Čo ak by sme si ku každej inštalácii vyrobili "balíček" pozostávajúci zo súborov, ktoré inštalácia vyrobila, informácie kam treba tieto súbory nakopírovať a hodnôt, ktoré treba zapísať do registrov.

%\subsection{Rozdielne inštalácie}
%\paragraph{}
%V predošlej časti sme predpokladali, že množina programov sa nemení medzi počítačmi. To sa avšak nestáva často a skôr by sme potrebovali na pre každý počítač jeho vlastnú množinu programov. Jedno z možných riešení je upravovať balíčky podľa potreby, avšak to je práca naviac pre administrátora a tomu sa chceme vyhnúť. Tak prečo nedelegovať výber programov priamo na používateľa ? Vyrobíme zoznam programov, ktoré si môže nainštalovať a používateľ si vybere, ktoré z nich si nainštaluje.

%\section{Návrh riešenia}

%\paragraph{}
%Výsledkom tejto bakalárskej práce bude aplikácie pozostávajúca z dvoch častí, administrátorskej a uživatelskej.

%\subsection{Administrátor}
%Administrátorska časť programu bude vedieť vyrábať vyššie spomenuté "balíčky" aplikácii. Bude vedieť určovať závislosti medzi balíkmi a spôsob inštalácie (na požiadanie alebo automaticky). Týmto by mal vyrobiť veľkú databázu aplikácii prísupnych ostatným použivateľom na sieti. Celá táto databáza bude uložená na serveri.

%\subsection{Použivateľ}
%Použivateľská časť programu bude pozostávať zo zoznamu balíčkov dostupných na servery. Použivateľ bude mať možnosť kedykoľvek, ktorýkoľvek balík nainštalovať a začať používať. Program bude vedieť, ktoré balíčky použivateľ už ma nainštalované a v prípade, že bude chcieť nainštalovať už nainštalovaný balíček, tak mu namiesto toho pustí daný program.

\section{Zadefinovanie Problému}

\paragraph{}
V dnešnej dobe, najdôležitejším nástrojom  zamestnanca vo firme aby bol produktívny je počítač. Avšak aj napriek tomuto faktu mnoho z týchto zamestnancov počítačom nerozumie a vyžadujú pomoc firemného administrátora pri inštalácii počítaču alebo niektorých programov. Táto úloha je síce z pohľadu informatika triviálna, avšak zaberá obrovské množstvo času vzhľadom na jej obťažnosť. Administrátor dokáže stráviť niekoľko dní nad prípravou novokúpených  počítačov, pred tým ako ich odovzdá zamestnancom. Toto je spôsobené hlavne veľkým množstvom ovládačov programov bez ktorých je počítač takmer nepoužiteľný. 
Problém, ktorému sa v tejto práci budeme venovať a výsledný program ho má čo najefektívnejšie riešiť, je ako presunúť čo najviac práce s prípravou počítaču do funkčného stavu presunúť z administrátora na užívateľa s tým, že od užívateľa nebudeme vyžadovať žiadne nové znalosti, ani mu nebudeme musieť prideľovať vyššie prístupové práva.

\section{Návrh riešenia}

\paragraph{}
Bohužiaľ inštalácie na operačnom systéme Windows nie sú homogénne. Veľa výrobcov softvéru si programuje svoje vlastné inštalačné programy a preto výroba aplikácie, ktoré by vedela automatický obslúžiť akúkoľvek inštaláciu, by bola takmer nemožná. Preto v rámci riešenia problému si budeme generovať vlastné inštalácie, ktoré budú mať spoločnú predlohu a vďaka tejto vlastnosti budeme môcť vyrobiť aplikáciu, ktorá tieto inštalácie bez zásahu užívateľa.  Toto riešenie vyrobí balíčky, ktoré následne presunie na cieľovú stanicu, kde sa rozbalia a tým nainštalujú želaný program. Celý tento proces môže byť pre používateľa neviditeľný.  Implementáciu a finálnu aplikáciu vieme rozdeliť na tieto časti:

\begin{itemize}
\item Odchytenie a uloženie priebehu inštalácie do balíčku
\item Inštalácia balíčku na cieľovej stanici
\item Prenos balíčkov medzi stanicou a serverovým úložiskom
\end{itemize}

\subsection{Príprava balíčkov}

\paragraph{Priamočiare riešenie}
Priamočiary prístup k tomuto problému pozostáva z vyrobenia zoznamu súborov na disku pred a po inštalácii a nasledovné vytvorenie rozdielu medzi týmito zoznamami. Avšak pri výrobe rozdielu by bolo treba kontrolovať aj čas poslednej úpravy pre súbory, ktoré neboli inštaláciou vytvorené ale len zmenené. V dnešnej dobe, kedy veľkostí pevných diskov sa pohybujú v stovkách gigabajtov, je tento proces zdĺhavý a neefektívny. 
\paragraph{Pomocou obalenia inštalácie}
Ďalším možným riešením zisťovania zmien, ktoré inštalácia vykonala, je vytvorenie aplikácie, ktorá obalí inštalačný program a bude reagovať na jeho volania operačnému systému na vytvorenie alebo zmenu súborov. Tento prístup je v ohľade na rýchlosť vykonávania nesmierne rýchly, avšak nie dokonalý. Pri implementácií by sme museli filtrovať volania operácií na dočasných súboroch, ktoré si inštalácia môže vytvárať počas svojho behu. Implementácia tohto prístupu by bola viazaná na konkrétny proces inštalácie a museli by sme ošetrovať špeciálne prípady, kedy inštalácia používa pomocné procesy, ktorých volania by nemuseli byť odchytené pôvodnou aplikáciou. 
\paragraph{Odchytením zmien na súborovom systéme}
Posledné riešenie, ktoré spomenieme a ktoré budeme neskôr implementovať, je pomocou štandardných knižníc .NET frameworku pre systémy Windows. V týchto knižniciach nájdeme mnoho nástrojov, ktoré nám pomôžu narábať so súborovým systémom. V tomto konkrétnom prípade použijeme triedu FileSystemWatcher, ktorá čaká na udalosti zo súborového systému a posiela ich ďalej do programu. Týmto spôsobom sa vyhneme vytváraniu kompletného zoznamu súborov na disku a zároveň zistíme zmeny v systéme vytvorené akýmkoľvek procesom v danom čase. S týmto prichádza aj mnoho negatív, ako zachytávanie udalostí od samotného operačného systému alebo programov bežiacich na pozadí nesúvisiacich s inštaláciou. Doteraz sme riešili ako zachytiť zmenu v súborovom systéme, avšak dôležitou súčasťou mnohých programov sú aj Windows registre. Spomínaný .NET framework obsahuje triedy na počúvanie udalostí v registroch, avšak tieto triedy neobsahujú dostatok informácií kde a aká zmena v registroch nastala aby sme ich mohli použiť. Preto pri zisťovaní zmien v registroch použijeme ich základne funkcie a to výpis podstromu  registrov do súboru a načítanie podstromu registrov zo súboru. Zmeny, ktoré vznikli počas inštalácie získame z rozdielu výpisov registrov pred a po inštalácií. Zistením zoznamu súborov a registrov, ktoré sa vyrobili alebo zmenili počas inštalácie dostaneme balíček, ktorý obsahuje všetky potrebné veci pre fungovanie daného programu.

\subsection{Inštalácia balíčkov}

Po tom ako pripravíme balíčky vyššie uvedeným spôsobom, treba spraviť inštaláciu programov z daných balíčkov. Balíčky majú nami zadefinovanú štruktúru ktorá obsahuje nasledovné informácie:

\begin{itemize}
\item Súbory programu
\item Výpis registrov, ktoré program vyžaduje
\item Zoznam súborov programu a miesto ich inštalácie
\item Zoznam spustiteľných súborov na ktoré sa ma vytvoriť odkaz
\item Balíčky, ktoré treba mať nainštalované
\item Inštalácia pri štarte systému alebo až na vyžiadanie užívateľa
\end{itemize}

Úlohou tejto časti aplikácie bude rozbaliť súbory z balíčka na miesto, ktoré bolo určené pri inštalácii, načítanie hodnôt registrov podľa výpisu v balíčku a vytvorenie odkazu na spustiteľné súbory, ktoré by užívateľa mohli zaujímať.

\subsection{Prenos balíčkov}

Ako posledné budeme v implementácií riešiť prenášanie balíčkov na cieľové stanice. Vychádzať budeme z predpokladu, že naša aplikácia bude používaná v prostredí obsahujúcom sieťové spojenie medzi stanicami a stanicu na ktorej sa budú skladovať všetky dostupné balíčky, pre potreby tejto práce ju budeme nazývať server. Úlohou aplikácie po vytvorení balíčku na vzorovom počítači bude poslať tento balíček na server a zapísať ho do zoznamu dostupných balíčkov. Prenos dát a komunikácia medzi serverom a ostatnými stanicami bude prebiehať pomocou SSL technológie.

\section{Fungovanie aplikácie}

Aplikácia bude mať dve spustiteľné zložky, administrátorskú a užívateľskú. Zatiaľ čo administrátorská časť bude obyčajná Windows aplikácia, ktorú bude treba manuálne spustiť, užívateľská bude reagovať na špeciálne vytvorené odkazy aplikácií
\paragraph{Administrátor}
Po spustení tejto časti aplikácie, bude administrátor prezentovaný aplikáciou obsahujúcou ovládanie na úpravu všetkých nastavení ako napríklad adresa serveru, adresa kam treba vyrábať odkazy na programy a podobne. Ďalej sa tu bude nachádzať ovládanie časti na vytváranie balíčkov, spustenie/vypnutie zachytávania zmien v súborovom systéme a chybový výpis. Zmena niektorých nastavení alebo odchytávanie procesu bude vyžadovať administrátorské heslo.
\paragraph{Užívateľ}
Odkazy vytvorené našou aplikáciou, budú smerovať k tejto časti aplikácie, ktorá skontroluje či už daný program existuje a rozhodne, či treba spustiť balíček na inštaláciu alebo samotný program.
Konfigurácia

Všetky nastavenia, ktoré aplikácia potrebuje budú uložené vo Windows registroch a bude sa k ním dať pristúpiť cez administračnú časť aplikácie. Tieto nastavenia zahŕňajú:

\begin{itemize}
\item Cesta k aplikácii
\item Cesta k balíčkom
\item Cesta k odkazom na programy
\item Adresa serveru
\item Administračné heslo
\end{itemize}

Takisto v týchto registroch budú uložené ďalšie informácie, ktoré sa nebudú dať zmeniť a budú generované automatický aplikáciou ako napríklad čas posledného obnovenia zoznamu balíčkov na serveri.

